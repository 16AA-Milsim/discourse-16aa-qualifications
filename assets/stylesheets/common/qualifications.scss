/* ===== THEME TOKENS ===== */
$qual-table-bg-light: rgb(245, 245, 245);
$qual-header-text-light: rgb(34, 34, 34);
$qual-header-bg-light: rgb(230, 230, 230);
$qual-header-shadow-light: rgba(0, 0, 0, 0.116);
$qual-border-color-light: rgb(214, 214, 214);
$qual-row-border-light: rgb(255, 255, 255);
$qual-username-color-light: rgba(31, 41, 55, 1);
$qual-real-name-color-light: rgba(75, 85, 99, 1);
$qual-unit-position-color-light: rgba(107, 114, 128, 1);
$qual-missing-text-light: rgba(75, 85, 99, 1);
$qual-qualified-bg-light: rgba(0, 255, 47, 0.185);
$qual-qualified-text-light: rgba(255, 255, 255, 1);
$qual-empty-text-light: rgba(75, 85, 99, 1);
$qual-empty-bg-light: rgba(255, 255, 255, 1);
$qual-empty-border-light: rgba(216, 221, 230, 1);
$qual-color-red-light: rgba(255, 0, 0, 0.2);
$qual-color-orange-light: rgba(255, 119, 0, 0.2);
$qual-color-yellow-light: rgba(255, 179, 0, 0.2);
$qual-color-green-light: rgba(0, 255, 47, 0.2);
$qual-hover-overlay-light: rgba(0, 0, 0, 0.05);

$qual-table-bg-dark: rgba(39, 39, 39, 1);
$qual-header-text-dark: rgb(233, 233, 233);
$qual-header-bg-dark: rgb(24, 24, 24);
$qual-header-shadow-dark: rgba(0, 0, 0, 0.151);
$qual-border-color-dark: rgb(20, 20, 20);
$qual-row-border-dark: rgba(34, 34, 34, 1);
$qual-username-color-dark: rgba(212, 212, 212, 1);
$qual-real-name-color-dark: rgba(203, 213, 245, 1);
$qual-unit-position-color-dark: rgba(141, 141, 141, 1);
$qual-missing-text-dark: rgba(154, 164, 178, 1);
$qual-qualified-bg-dark: rgba(0, 255, 38, 0.08);
$qual-qualified-text-dark: rgba(228, 228, 228, 1);
$qual-empty-text-dark: rgba(205, 212, 228, 1);
$qual-empty-bg-dark: rgba(27, 30, 38, 1);
$qual-empty-border-dark: rgba(47, 53, 66, 1);
$qual-color-red-dark: rgba(255, 0, 0, 0.2);
$qual-color-orange-dark: rgba(255, 102, 0, 0.2);
$qual-color-yellow-dark: rgba(255, 174, 0, 0.2);
$qual-color-green-dark: rgba(0, 255, 40, 0.2);
$qual-hover-overlay-dark:  rgba(255, 255, 255, 0.05);

@mixin set-qualification-vars(
  $table-bg, $header-text, $header-bg, $header-shadow, $border-color, $row-border,
  $username-color, $real-name-color, $unit-position-color, $missing-color,
  $qualified-bg, $qualified-text, $empty-text, $empty-bg, $empty-border,
  $red, $orange, $yellow, $green, $hover-overlay
) {
  --qual-table-bg: #{$table-bg};
  --qual-header-text: #{$header-text};
  --qual-header-bg: #{$header-bg};
  --qual-header-shadow: #{$header-shadow};
  --qual-border-color: #{$border-color};
  --qual-row-border-color: #{$row-border};
  --qual-username-color: #{$username-color};
  --qual-real-name-color: #{$real-name-color};
  --qual-unit-position-color: #{$unit-position-color};
  --qual-missing-text-color: #{$missing-color};
  --qual-qualified-bg: #{$qualified-bg};
  --qual-qualified-text: #{$qualified-text};
  --qual-empty-text-color: #{$empty-text};
  --qual-empty-bg: #{$empty-bg};
  --qual-empty-border-color: #{$empty-border};
  --qual-text-size: 0.9rem;
  --qual-header-size: 0.95rem;
  --16aa-qual-red: #{$red};
  --16aa-qual-orange: #{$orange};
  --16aa-qual-yellow: #{$yellow};
  --16aa-qual-green: #{$green};
  --qual-hover-overlay: #{$hover-overlay};
}

/* ===== ROOT ===== */

.qualifications-page--light {
  max-width: 1065px;
  @include set-qualification-vars(
    $qual-table-bg-light, $qual-header-text-light, $qual-header-bg-light, $qual-header-shadow-light, $qual-border-color-light, $qual-row-border-light,
    $qual-username-color-light, $qual-real-name-color-light, $qual-unit-position-color-light, $qual-missing-text-light,
    $qual-qualified-bg-light, $qual-qualified-text-light, $qual-empty-text-light, $qual-empty-bg-light, $qual-empty-border-light,
    $qual-color-red-light, $qual-color-orange-light, $qual-color-yellow-light, $qual-color-green-light, $qual-hover-overlay-light
  );
}

.qualifications-page--dark {
  max-width: 1065px;
  @include set-qualification-vars(
    $qual-table-bg-dark, $qual-header-text-dark, $qual-header-bg-dark, $qual-header-shadow-dark, $qual-border-color-dark, $qual-row-border-dark,
    $qual-username-color-dark, $qual-real-name-color-dark, $qual-unit-position-color-dark, $qual-missing-text-dark,
    $qual-qualified-bg-dark, $qual-qualified-text-dark, $qual-empty-text-dark, $qual-empty-bg-dark, $qual-empty-border-dark,
    $qual-color-red-dark, $qual-color-orange-dark, $qual-color-yellow-dark, $qual-color-green-dark, $qual-hover-overlay-dark
  );
}

.qualifications-table-wrapper {
  overflow: auto;
  height: auto;
  min-height: 200px;
  max-height: calc(100vh - 210px);
  position: relative;
  background: var(--qual-table-bg);
  box-shadow:
    2px 5px 5px rgba(0, 0, 0, 0.123);
  border-radius: 0.5rem;
  align-self: start;
}

/* ===== CELL LAYERS ===== */

.qualification-cell__content {
  position: relative; z-index: 2;
  display: flex; align-items: center; justify-content: center;
  width: 100%; height: 100%; text-align: center;
}

/* ===== TABLE ===== */

.qualifications-table tbody tr:first-child,
.qualifications-table tbody tr:first-child td {
  border-top: 0 !important;
  box-shadow: none;
}

.qualifications-table tbody tr:last-child::after { display: none; }

/* keep hover wash below the separator */
.qualifications-table .qualification-row:hover td::after { z-index: 1; }

.qualifications-table thead > tr,
.qualifications-table tbody > tr {
  border-bottom: 0 !important;
}

.qualifications-table th,
.qualifications-table td {
  border-bottom: 0 !important;
}

.qualifications-table tbody > tr { position: relative; }
.qualifications-table tbody > tr::after {
  content: "";
  position: absolute;
  left: 0; right: 0; bottom: 0; height: 1px;
  background: var(--qual-row-border-color);
  pointer-events: none;
  z-index: 2;
}
.qualifications-table tbody > tr:last-child::after { display: none; }

.qualifications-table {
  width: max-content;
  min-width: 100%;
  table-layout: fixed;
  border-collapse: separate;
  border-spacing: 0;
  background: var(--qual-table-bg); border-radius: 0.5rem;

  th:not(.user-column),
  td:not(.user-cell) {
    width: 2.74rem;
    min-width: 2.74rem;
    max-width: 2.74rem;
  }

  .user-cell,
  .user-column {
    width: auto;
  }

  thead::before {
    content: "";
    position: absolute;
    left: 0; right: 0; bottom: 0;
    height: 2px;
    background: var(--qual-border-color);
    pointer-events: none;
    z-index: 12;
  }

  thead::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0px;
    height: 10px;
    pointer-events: none;
    box-shadow: 0 6px 12px var(--qual-header-shadow);
    z-index: 11;
  }

  thead {
    background: var(--qual-header-bg);
    position: sticky;
    top: 0;
    z-index: 10;
    isolation: isolate;

    th {
      position: sticky;
      top: 0;
      z-index: 5;
      padding: 0.5rem;
      text-align: center;
      font-weight: 600;
      border-bottom: none;
      /* box-shadow: inset 0 -2px var(--qual-border-color); */
      background: var(--qual-header-bg);
      font-size: var(--qual-header-size, 0.95rem);
      &.user-column { text-align: left; }
      color: var(--qual-header-text);
    }
  }

  tbody {
    tr:first-child, tr:first-child td {
      border-top: 0 !important;
      box-shadow: none;
    }
    tr::after {
      content: "";
      position: absolute;
      left: 0; right: 0; bottom: 0; height: 1px;
      background: var(--qual-row-border-color);
      pointer-events: none;
      z-index: 2;
    }

    tr:last-child::after { display: none; }

    tr {
      position: relative; /* required for the ::after 1px separator */
    }
  }

  td {
    position: relative;
    padding: 0; text-align: center; vertical-align: middle; white-space: nowrap;
  }

  /* zebra columns (single, non-duplicated rules) */
  .qualification-row td:nth-child(even):not(.user-cell) {
    background: color-mix(in srgb, var(--qual-table-bg), rgba(255, 255, 255, 0.08));
  }
  .qualification-row td:nth-child(odd):not(.user-cell) {
    background: color-mix(in srgb, var(--qual-table-bg), rgba(0, 0, 0, 0.08));
  }

  /* row hover wash (above tint overlays, below content) */
  .qualification-row:hover td::after {
    content: "";
    position: absolute;
    inset: 0;
    background: var(--qual-hover-overlay);
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
    transition: opacity 120ms ease-in-out;
  }
  .qualification-row:hover td.user-cell::after {
    background: var(--qual-hover-overlay);
  }

  .qualification-row {
    .user-cell {
      text-align: left;
      min-width: 120px;
      font-size: var(--d-font-size-100, 1rem);
      padding: 0.6rem 0.75rem;

      .user-meta {
        display: flex; flex-direction: column; gap: 0.15rem;

        .username { font-weight: 600; color: var(--qual-username-color); }
        .name { font-size: 0.85rem; color: var(--qual-real-name-color); }
        .unit-position { font-size: 0.75rem; color: var(--qual-unit-position-color); }
      }
    }

    td {
      min-width: 3.4rem; font-weight: 500;
      font-size: var(--qual-text-size, 0.9rem);
    }

    .qualification-cell {
      background: transparent; padding: 0; width: 100%; height: 100%;
      &.missing { color: var(--qual-missing-text-color); }
    }
  }
}

/* missing-state tint (uses --qualification-overlay set by JS) */
td.qualification-cell--overlay::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: linear-gradient(
    to bottom,
    var(--qualification-overlay, transparent),
    var(--qualification-overlay, transparent)
  );
  background-blend-mode: multiply;
  pointer-events: none;
  z-index: 0;   /* base layer */
}

/* qualified-state tint (green) using the tdâ€™s 'qualified' class */
td.qualification-cell.qualified::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: linear-gradient(
    to bottom,
    var(--qual-qualified-bg, rgba(47, 158, 68, 0.25)),
    var(--qual-qualified-bg, rgba(47, 158, 68, 0.25))
  );
  background-blend-mode: multiply;
  pointer-events: none;
  z-index: 0;
}

/* ===== EMPTY STATE ===== */
.qualifications-empty {
  padding: 2rem; text-align: center;
  color: var(--qual-empty-text-color);
  background: var(--qual-empty-bg);
  border-radius: 0.5rem;
  border: 1px dashed var(--qual-empty-border-color);
}

/* ===== INTERACTION ELEMENTS ===== */
.qualification-cell__trigger,
.qualification-cell__trigger:visited { color: inherit; text-decoration: none; }

.qualification-cell__trigger:hover,
.qualification-cell__trigger:active { text-decoration: none; }

.qualification-cell__trigger:focus { text-decoration: underline; }

.qualification-cell__trigger,
.qualification-cell__trigger:visited,
.qualification-cell__trigger:hover,
.qualification-cell__trigger:active,
.qualification-cell__trigger:focus { color: inherit; }

.qualification-cell__trigger-wrapper {
  display: flex; align-items: center; justify-content: center;
  width: 100%; height: 100%; padding: 0.35rem 0.45rem; box-sizing: border-box; text-align: center;
}
.qualification-cell__trigger--empty { min-height: 1.2rem; }
.qualification-cell__trigger-wrapper--empty { pointer-events: none; }

.qualification-tooltip,
.qualification-tooltip .fk-d-tooltip__trigger { display: block; width: 100%; height: 100%; }
.qualification-tooltip .fk-d-tooltip__trigger-container {
  display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;
}

/* ===== BADGE TOOLTIP CONTENT ===== */
.qualification-badge-content { text-align: left; max-width: 260px; }
.qualification-badge-tooltip { display: flex; align-items: flex-start; gap: 0.75rem; }
.qualification-badge-tooltip__icon {
  flex: 0 0 auto; width: 64px; height: 64px; display: flex; align-items: center; justify-content: center;
  img { max-width: 64px; max-height: 64px; border-radius: 4px; }
  .d-icon { font-size: 1.75rem; }
}
.qualification-badge-tooltip__body { display: flex; flex-direction: column; gap: 0.35rem; }
.qualification-badge-tooltip__name { font-weight: 600; font-size: 0.95rem; }
.qualification-badge-tooltip__description { font-size: 0.85rem; line-height: 1.4; opacity: 0.85; }

/* ===== ADMIN PAGE (unchanged, concise) ===== */
.qualifications-admin {
  padding: 2rem;
  &__header {
    display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;
    h1 { margin: 0; }
    .actions { display: flex; gap: 0.75rem; }
  }
  &__instructions { margin-bottom: 1.5rem; color: #666; }
  &__section { margin-bottom: 1.5rem; label { display: block; font-weight: 600; margin-bottom: 0.5rem; } }
  &__textarea { width: 100%; font-family: var(--font-family-monospace); }
}

/* ===== MOBILE TWEAKS ===== */
@media (max-width: 768px) {
  .qualifications-page { padding: 1rem; }

  .qualifications-table {
    thead th { padding: 0.5rem; font-size: var(--qual-header-size, 0.95rem); }
    td { white-space: nowrap; }
    .qualification-row {
      .user-cell { padding: 0.55rem 0.65rem; }
      td { min-width: 3.4rem; font-size: var(--qual-text-size, 0.85rem); }
      td:not(.user-cell) { width: 3.4rem; }
    }
  }

  .qualification-cell__trigger-wrapper { padding: 0.4rem 0.45rem; }
}
